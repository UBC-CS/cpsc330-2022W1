
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 3: Machine Learning Fundamentals &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/03_ml-fundamentals.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/03_ml-fundamentals.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-plan-for-today">
   Lecture plan for today
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#announcements">
   Announcements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-learning-objectives">
   Lecture learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generalization-video">
   Generalization [video]
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#big-picture-and-motivation">
     Big picture and motivation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-complexity-and-training-error">
     Model complexity and training error
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eva-s-questions">
     ü§î Eva‚Äôs questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generalization-fundamental-goal-of-ml">
     Generalization: Fundamental goal of ML
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generalizing-to-unseen-data">
     Generalizing to unseen data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-error-vs-generalization-error">
     Training error vs. Generalization error
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting-video">
   Data Splitting [video]
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-approximate-generalization-error">
     How to approximate generalization error?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-train-test-split">
     Simple train/test split
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creating-train-df-and-test-df">
       Creating
       <code class="docutils literal notranslate">
        <span class="pre">
         train_df
        </span>
       </code>
       and
       <code class="docutils literal notranslate">
        <span class="pre">
         test_df
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-size-train-size-arguments">
       <code class="docutils literal notranslate">
        <span class="pre">
         test_size
        </span>
       </code>
       ,
       <code class="docutils literal notranslate">
        <span class="pre">
         train_size
        </span>
       </code>
       arguments
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#random-state-argument">
       <code class="docutils literal notranslate">
        <span class="pre">
         random_state
        </span>
       </code>
       argument
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-validation-test-split">
     Train/validation/test split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deployment-data">
     ‚ÄúDeployment‚Äù data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary-of-train-validation-test-and-deployment-data">
     Summary of train, validation, test, and deployment data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-on-generalization-and-data-splitting">
     ‚ùì‚ùì Questions on generalization and data splitting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#true-or-false">
     True or False
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-discussion">
     Questions for discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cross-validation-video">
   Cross-validation [video]
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems-with-single-train-validation-split">
     Problems with single train/validation split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cross-validation-to-the-rescue">
     Cross-validation to the rescue!!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cross-validation-using-scikit-learn">
     Cross-validation using
     <code class="docutils literal notranslate">
      <span class="pre">
       scikit-learn
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cross-val-score">
       <code class="docutils literal notranslate">
        <span class="pre">
         cross_val_score
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cross-validate">
       <code class="docutils literal notranslate">
        <span class="pre">
         cross_validate
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#our-typical-supervised-learning-set-up-is-as-follows">
       Our typical supervised learning set up is as follows:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-on-cross-validation">
     ‚ùì‚ùì Questions on cross-validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#underfitting-overfitting-the-fundamental-trade-off-the-golden-rule-video">
   Underfitting, overfitting, the fundamental trade-off, the golden rule [video]
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#types-of-errors">
     Types of errors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#underfitting">
     Underfitting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting">
     Overfitting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-fundamental-tradeoff-of-supervised-learning">
     The ‚Äúfundamental tradeoff‚Äù of supervised learning:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bias-vs-variance-tradeoff">
     Bias vs variance tradeoff
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-pick-a-model-that-would-generalize-better">
     How to pick a model that would generalize better?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-score-vs-cross-validation-score">
     test score vs. cross-validation score
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-golden-rule-a-name-4-a">
     The golden rule
     <a name="4">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#golden-rule-violation-example-1">
       Golden rule violation: Example 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#golden-rule-violation-example-2">
       Golden rule violation: Example 2
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-can-we-avoid-violating-golden-rule">
     How can we avoid violating golden rule?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#here-is-the-workflow-we-ll-generally-follow">
     Here is the workflow we‚Äôll generally follow.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-you">
     ‚ùì‚ùì Questions for you
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#underfitting-or-overfitting">
     Underfitting or overfitting?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-whether-true-false">
     State whether True/False.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-did-we-learn-today">
   What did we learn today?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coming-up">
     Coming up ‚Ä¶
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<div class="section" id="lecture-3-machine-learning-fundamentals">
<h1>Lecture 3: Machine Learning Fundamentals<a class="headerlink" href="#lecture-3-machine-learning-fundamentals" title="Permalink to this headline">¬∂</a></h1>
<p>UBC 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¬∂</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">graphviz</span>
<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Classifiers</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">export_graphviz</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lecture-plan-for-today">
<h2>Lecture plan for today<a class="headerlink" href="#lecture-plan-for-today" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>Announcements and intro (~5 mins)</p></li>
<li><p>Exercises and Q&amp;A on pre-watched videos (~10 mins)</p></li>
<li><p>Watch <a class="reference external" href="https://youtu.be/4cv8VYonepA">cross-validation video</a> (~11 mins)</p></li>
<li><p>Exercises and Q&amp;A on cross validation (~5 mins)</p></li>
<li><p>Break</p></li>
<li><p>Watch <a class="reference external" href="https://youtu.be/Ihay8yE5KTI">the fundamental tradeoff video</a> (~20 mins)</p></li>
<li><p>Exercises and Q&amp;A on the fundamental tradeoff (~15 mins)</p></li>
<li><p>Summary and wrap up (~5 mins)</p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>Extension for hw1</p>
<ul>
<li><p>Check out <a class="reference external" href="https://piazza.com/class/kt60nrdhu53454?cid=69">&#64;69 on Piazza</a>.</p></li>
</ul>
</li>
<li><p>hw2 released. (Due next week Monday at 11:59pm.)</p>
<ul>
<li><p>You are welcome to broadly discuss it with your classmates but final answers and submissions must be your own.</p></li>
</ul>
</li>
<li><p>Advice on keeping up with the material</p>
<ul>
<li><p>Practice! You will find some practice questions <a class="reference external" href="https://ml-learn.mds.ubc.ca/">here</a>.</p></li>
<li><p>Start early on homework assignments.</p></li>
</ul>
</li>
<li><p>If you are still on the waitlist, it‚Äôs your responsibility to keep up with the material and submit assignments.</p></li>
<li><p>Try to avoid asking questions in the break. If you have specific questions and you want to talk to me in person, we can do it outside after the class.</p></li>
<li><p>Last day to withdraw without a W standing:	September 20, 2021</p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="lecture-learning-objectives">
<h2>Lecture learning objectives<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this headline">¬∂</a></h2>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>explain how decision boundaries change with the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameter;</p></li>
<li><p>explain the concept of generalization;</p></li>
<li><p>appropriately split a dataset into train and test sets using <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code> function;</p></li>
<li><p>explain the difference between train, validation, test, and ‚Äúdeployment‚Äù data;</p></li>
<li><p>identify the difference between training error, validation error, and test error;</p></li>
<li><p>explain cross-validation and use <code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code> and <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> to calculate cross-validation error;</p></li>
<li><p>recognize overfitting and/or underfitting by looking at train and test scores;</p></li>
<li><p>explain why it is generally not possible to get a perfect test score (zero test error) on a supervised learning problem;</p></li>
<li><p>describe the fundamental tradeoff between training score and the train-test gap;</p></li>
<li><p>state the golden rule;</p></li>
<li><p>start to build a standard recipe for supervised learning: train/test split, hyperparameter tuning with cross-validation, test on test set.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="generalization-video">
<h2>Generalization [<a class="reference external" href="https://youtu.be/iS2hsRRlc2M">video</a>]<a class="headerlink" href="#generalization-video" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="big-picture-and-motivation">
<h3>Big picture and motivation<a class="headerlink" href="#big-picture-and-motivation" title="Permalink to this headline">¬∂</a></h3>
<p>In machine learning, we want to glean information from labeled data so that we can label <strong>new unlabeled</strong> data. For example, suppose we want to build a spam filtering system.  We will take a large number of spam/non-spam messages from the past, learn patterns associated with spam/non-spam from them, and predict whether <strong>a new incoming message</strong> in someone‚Äôs inbox is spam or non-spam based on these patterns.</p>
<p>So we want to learn from the past but ultimately we want to apply it on the future email messages.</p>
<p><img alt="" src="../_images/eva-think.png" /></p>
<p><strong>How can we generalize from what we‚Äôve seen to what we haven‚Äôt seen?</strong></p>
<p>In this lecture, we‚Äôll see how machine learning tackles this question.</p>
</div>
<div class="section" id="model-complexity-and-training-error">
<h3>Model complexity and training error<a class="headerlink" href="#model-complexity-and-training-error" title="Permalink to this headline">¬∂</a></h3>
<p>In the last lecture, we looked at decision boundaries, a way to visualize what sort of examples will be classified as positive and negative.</p>
<p>Let‚Äôs examine how does the decision boundary change for different tree depths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Toy quiz2 grade data</span>
<span class="n">classification_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/quiz2-grade-toy-classification.csv&quot;</span><span class="p">)</span>
<span class="n">classification_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml_experience</th>
      <th>class_attendance</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>quiz2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>92</td>
      <td>93</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>94</td>
      <td>90</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>78</td>
      <td>85</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>91</td>
      <td>94</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>1</td>
      <td>77</td>
      <td>83</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>0</td>
      <td>70</td>
      <td>73</td>
      <td>68</td>
      <td>74</td>
      <td>71</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>0</td>
      <td>80</td>
      <td>88</td>
      <td>89</td>
      <td>88</td>
      <td>91</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>95</td>
      <td>93</td>
      <td>69</td>
      <td>79</td>
      <td>75</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
      <td>97</td>
      <td>90</td>
      <td>94</td>
      <td>99</td>
      <td>80</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>1</td>
      <td>95</td>
      <td>95</td>
      <td>94</td>
      <td>94</td>
      <td>85</td>
      <td>not A+</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">classification_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;quiz2&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">classification_df</span><span class="p">[</span><span class="s2">&quot;quiz2&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_subset</span> <span class="o">=</span> <span class="n">X</span><span class="p">[[</span><span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="s2">&quot;quiz1&quot;</span><span class="p">]]</span> <span class="c1"># Let&#39;s consider a subset of the data for visualization</span>
<span class="n">X_subset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lab4</th>
      <th>quiz1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>91</td>
      <td>92</td>
    </tr>
    <tr>
      <th>1</th>
      <td>83</td>
      <td>91</td>
    </tr>
    <tr>
      <th>2</th>
      <td>80</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>91</td>
      <td>89</td>
    </tr>
    <tr>
      <th>4</th>
      <td>92</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In the following model, this decision boundary is created by asking one question.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
<span class="n">plot_tree_decision_boundary_and_tree</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;quiz1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error:   0.286
</pre></div>
</div>
<img alt="../_images/03_ml-fundamentals_18_1.png" src="../_images/03_ml-fundamentals_18_1.png" />
</div>
</div>
<p>In the following model, this decision boundary is created by asking two questions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">depth</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
<span class="n">plot_tree_decision_boundary_and_tree</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;quiz1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error:   0.190
</pre></div>
</div>
<img alt="../_images/03_ml-fundamentals_20_1.png" src="../_images/03_ml-fundamentals_20_1.png" />
</div>
</div>
<p>Let‚Äôs look at the decision boundary with depth = 4.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">depth</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
<span class="n">plot_tree_decision_boundary_and_tree</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;quiz1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error:   0.048
</pre></div>
</div>
<img alt="../_images/03_ml-fundamentals_22_1.png" src="../_images/03_ml-fundamentals_22_1.png" />
</div>
</div>
<p>Let‚Äôs look at the decision boundary with depth = 6.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">depth</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
<span class="n">plot_tree_decision_boundary_and_tree</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;quiz1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error:   0.000
</pre></div>
</div>
<img alt="../_images/03_ml-fundamentals_24_1.png" src="../_images/03_ml-fundamentals_24_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">max_depth</span> <span class="ow">in</span> <span class="n">max_depths</span><span class="p">:</span>
    <span class="n">error</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">max_depths</span><span class="p">,</span> <span class="n">errors</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;max depth&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_25_0.png" src="../_images/03_ml-fundamentals_25_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Our model has 0% error for depths &gt;= 6!!</p></li>
<li><p>But it‚Äôs also becoming more and more specific and sensitive to the training data.</p></li>
<li><p>Is it good or bad?</p></li>
</ul>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>Although the plot above (complexity hyperparameter vs error) is more popular, we could also look at the same plot flip the <span class="math notranslate nohighlight">\(y\)</span>-axis, i.e., consider accuracy instead of error.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">accuracies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">max_depth</span> <span class="ow">in</span> <span class="n">max_depths</span><span class="p">:</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">accuracies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">max_depths</span><span class="p">,</span> <span class="n">accuracies</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;max depth&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_28_0.png" src="../_images/03_ml-fundamentals_28_0.png" />
</div>
</div>
</div>
<div class="section" id="eva-s-questions">
<h3>ü§î Eva‚Äôs questions<a class="headerlink" href="#eva-s-questions" title="Permalink to this headline">¬∂</a></h3>
<p><img alt="" src="../_images/eva-think.png" /></p>
<p>At this point Eva is wondering about the following questions.</p>
<ul class="simple">
<li><p>How to pick the best depth?</p></li>
<li><p>How can we make sure that the model we have built would do reasonably well on new data in the wild when it‚Äôs deployed?</p></li>
<li><p>Which of the following rules learned by the decision tree algorithm are likely to generalize better to new data?</p></li>
</ul>
<blockquote>
<div><p>Rule 1: If class_attendance == 1 then grade is A+.</p>
</div></blockquote>
<blockquote>
<div><p>Rule 2: If lab3 &gt; 83.5 and quiz1 &lt;= 83.5 and lab2 &lt;= 88 then quiz2 grade is A+</p>
</div></blockquote>
<p>To better understand the material in the next sections, think about these questions on your own or discuss them with your friend/neighbour before proceeding.</p>
<p><br><br><br><br></p>
</div>
<div class="section" id="generalization-fundamental-goal-of-ml">
<h3>Generalization: Fundamental goal of ML<a class="headerlink" href="#generalization-fundamental-goal-of-ml" title="Permalink to this headline">¬∂</a></h3>
<blockquote>
<div><p><strong>To generalize beyond what we see in the training examples</strong></p>
</div></blockquote>
<p>We only have access to limited amount of training data and we want to learn a mapping function which would predict targets reasonably well for examples beyond this training data.</p>
<ul class="simple">
<li><p>Example: Imagine that a learner sees the following images and corresponding labels.</p></li>
</ul>
<p><img alt="" src="../_images/generalization-train.png" /></p>
<!-- <center>
<img src='img/generalization-train.png' width="600" height="600" />
</center>     --></div>
<div class="section" id="generalizing-to-unseen-data">
<h3>Generalizing to unseen data<a class="headerlink" href="#generalizing-to-unseen-data" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Now the learner is presented with new images (1 to 4) for prediction.</p></li>
<li><p>What prediction would you expect for each image?</p></li>
</ul>
<p><img alt="" src="../_images/generalization-predict.png" /></p>
<!-- <center>
<img src='img/generalization-predict.png' width="1000" height="1000" />
</center>     --><ul class="simple">
<li><p>Goal: We want the learner to be able to generalize beyond what it has seen in the training data.</p></li>
<li><p>But these new examples should be representative of the training data. That is they should have the same characteristics as the training data.</p></li>
<li><p>In this example, we would like the leaner to be able to predict labels for test examples 1, 2, and 3 accurately. Although 2, 3 don‚Äôt exactly occur in the training data, they are very much similar to the images in the training data. That said, is it fair to expect the learner to label image 4 correctly?</p></li>
</ul>
</div>
<div class="section" id="training-error-vs-generalization-error">
<h3>Training error vs. Generalization error<a class="headerlink" href="#training-error-vs-generalization-error" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Given a model <span class="math notranslate nohighlight">\(M\)</span>, in ML, people usually talk about two kinds of errors of <span class="math notranslate nohighlight">\(M\)</span>.</p>
<ol class="simple">
<li><p>Error on the training data: <span class="math notranslate nohighlight">\(error_{training}(M)\)</span></p></li>
<li><p>Error on the entire distribution <span class="math notranslate nohighlight">\(D\)</span> of data: <span class="math notranslate nohighlight">\(error_{D}(M)\)</span></p></li>
</ol>
</li>
<li><p>We are interested in the error on the entire distribution</p>
<ul>
<li><p>‚Ä¶ But we do not have access to the entire distribution üòû</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="data-splitting-video">
<h2>Data Splitting [<a class="reference external" href="https://youtu.be/h2AEobwcUQw">video</a>]<a class="headerlink" href="#data-splitting-video" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="how-to-approximate-generalization-error">
<h3>How to approximate generalization error?<a class="headerlink" href="#how-to-approximate-generalization-error" title="Permalink to this headline">¬∂</a></h3>
<p>A common way is <strong>data splitting</strong>.</p>
<ul class="simple">
<li><p>Keep aside some randomly selected portion from the training data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code> (train) a model on the training portion only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">score</span></code> (assess) the trained model on this set aside data to get a sense of how well the model would be able to generalize.</p></li>
<li><p>Pretend that the kept aside data is representative of the real distribution <span class="math notranslate nohighlight">\(D\)</span> of data.</p></li>
</ul>
<p><img alt="" src="../_images/eva-good-idea.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scikit-learn train_test_split</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html&quot;</span>
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;iframe src=</span><span class="si">%s</span><span class="s2"> width=1000 height=800&gt;&lt;/iframe&gt;&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/IPython/core/display.py:724: UserWarning: Consider using IPython.display.IFrame instead
  warnings.warn(&quot;Consider using IPython.display.IFrame instead&quot;)
</pre></div>
</div>
<div class="output text_html"><iframe src=https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html width=1000 height=800></iframe></div></div>
</div>
<ul class="simple">
<li><p>We can pass <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> or a dataframe with both <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> in it.</p></li>
<li><p>We can also specify the train or test split sizes.</p></li>
</ul>
</div>
<div class="section" id="simple-train-test-split">
<h3>Simple train/test split<a class="headerlink" href="#simple-train-test-split" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>The picture shows an 80%-20% split of a toy dataset with 10 examples.</p></li>
<li><p>The data is shuffled before splitting.</p></li>
<li><p>Usually when we do machine learning we split the data before doing anything and put the test data in an imaginary chest lock.</p></li>
</ul>
<p><img alt="" src="../_images/train-test-split.png" /></p>
<!-- <img src='img/train-test-split.png' width="1500" height="1500" /> --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s demonstrate this with the canada usa cities data</span>
<span class="c1"># The data is available in the data directory</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/canada_usa_cities.csv&quot;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-130.0437</td>
      <td>55.9773</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-134.4197</td>
      <td>58.3019</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-123.0780</td>
      <td>48.9854</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-122.7436</td>
      <td>48.9881</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-122.2691</td>
      <td>48.9951</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>204</th>
      <td>-72.7218</td>
      <td>45.3990</td>
    </tr>
    <tr>
      <th>205</th>
      <td>-66.6458</td>
      <td>45.9664</td>
    </tr>
    <tr>
      <th>206</th>
      <td>-79.2506</td>
      <td>42.9931</td>
    </tr>
    <tr>
      <th>207</th>
      <td>-72.9406</td>
      <td>45.6275</td>
    </tr>
    <tr>
      <th>208</th>
      <td>-79.4608</td>
      <td>46.3092</td>
    </tr>
  </tbody>
</table>
<p>209 rows √ó 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0         USA
1         USA
2         USA
3         USA
4         USA
        ...  
204    Canada
205    Canada
206    Canada
207    Canada
208    Canada
Name: country, Length: 209, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>  <span class="c1"># 80%-20% train test split on X and y</span>

<span class="c1"># Print shapes</span>
<span class="n">shape_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Data portion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;X_train&quot;</span><span class="p">,</span> <span class="s2">&quot;y_train&quot;</span><span class="p">,</span> <span class="s2">&quot;X_test&quot;</span><span class="p">,</span> <span class="s2">&quot;y_test&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="n">shape_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shape_dict</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">shape_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Data portion</th>
      <th>Shape</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>X</td>
      <td>(209, 2)</td>
    </tr>
    <tr>
      <td>y</td>
      <td>(209,)</td>
    </tr>
    <tr>
      <td>X_train</td>
      <td>(167, 2)</td>
    </tr>
    <tr>
      <td>y_train</td>
      <td>(167,)</td>
    </tr>
    <tr>
      <td>X_test</td>
      <td>(42, 2)</td>
    </tr>
    <tr>
      <td>y_test</td>
      <td>(42,)</td>
    </tr>
  </tbody>
</table></div></div>
</div>
<div class="section" id="creating-train-df-and-test-df">
<h4>Creating <code class="docutils literal notranslate"><span class="pre">train_df</span></code> and <code class="docutils literal notranslate"><span class="pre">test_df</span></code><a class="headerlink" href="#creating-train-df-and-test-df" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>Sometimes we want to keep the target in the train split for EDA or for visualization.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>  <span class="c1"># 80%-20% train test split on df</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]),</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]),</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-76.4813</td>
      <td>44.2307</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>127</th>
      <td>-81.2496</td>
      <td>42.9837</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>169</th>
      <td>-66.0580</td>
      <td>45.2788</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>188</th>
      <td>-73.2533</td>
      <td>45.3057</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>187</th>
      <td>-67.9245</td>
      <td>47.1652</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_50_0.png" src="../_images/03_ml-fundamentals_50_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_51_0.svg" src="../_images/03_ml-fundamentals_51_0.svg" /></div>
</div>
<p>Let‚Äôs examine the train and test accuracies with the split now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train accuracy:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test accuracy:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train accuracy:   1.000
Test accuracy:   0.762
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_tree_decision_boundary_and_tree</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_54_0.png" src="../_images/03_ml-fundamentals_54_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span> <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">()})</span>
<span class="n">plot_tree_decision_boundary</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">eps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
    <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Decision tree model on the train data&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_tree_decision_boundary</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">X_test</span><span class="p">,</span>
    <span class="n">y_test</span><span class="p">,</span>
    <span class="n">eps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
    <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Decision tree model on the test data&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_55_0.png" src="../_images/03_ml-fundamentals_55_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Useful arguments of <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">test_size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="test-size-train-size-arguments">
<h4><code class="docutils literal notranslate"><span class="pre">test_size</span></code>, <code class="docutils literal notranslate"><span class="pre">train_size</span></code> arguments<a class="headerlink" href="#test-size-train-size-arguments" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>Let‚Äôs us specify how we want to split the data.</p></li>
<li><p>We can specify either of the two. See the documentation <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">here</a>.</p></li>
<li><p>There is no hard and fast rule on what split sizes should we use.</p>
<ul>
<li><p>It depends upon how much data is available to you.</p></li>
</ul>
</li>
<li><p>Some common splits are 90/10, 80/20, 70/30 (training/test).</p></li>
<li><p>In the above example, we used 80/20 split.</p></li>
</ul>
</div>
<div class="section" id="random-state-argument">
<h4><code class="docutils literal notranslate"><span class="pre">random_state</span></code> argument<a class="headerlink" href="#random-state-argument" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>The data is shuffled before splitting which is crucial step. (You will explore this in the lab.)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">random_state</span></code> argument controls this shuffling.</p></li>
<li><p>In the example above we used <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code>. If you run this notebook with the same <code class="docutils literal notranslate"><span class="pre">random_state</span></code> it should give you exactly the same split.</p>
<ul>
<li><p>Useful when you want reproducible results.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="train-validation-test-split">
<h3>Train/validation/test split<a class="headerlink" href="#train-validation-test-split" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Some of you may have heard of ‚Äúvalidation‚Äù data.</p></li>
<li><p>Sometimes it‚Äôs a good idea to have a separate data for hyperparameter tuning.</p></li>
</ul>
<p><img alt="" src="../_images/train-valid-test-split.png" /></p>
<!-- <img src='img/train-valid-test-split.png' width="1500" height="1500" /> --><ul class="simple">
<li><p>We will try to use ‚Äúvalidation‚Äù to refer to data where we have access to the target values.</p>
<ul>
<li><p>But, unlike the training data, we only use this for hyperparameter tuning and model assessment; we don‚Äôt pass these into <code class="docutils literal notranslate"><span class="pre">fit</span></code>.</p></li>
</ul>
</li>
<li><p>We will try to use ‚Äútest‚Äù to refer to data where we have access to the target values</p>
<ul>
<li><p>But, unlike training and validation data, we neither use it in training nor hyperparameter optimization.</p></li>
<li><p>We only use it <strong>once</strong> to evaluate the performance of the best performing model on the validation set.</p></li>
<li><p>We lock it in a ‚Äúvault‚Äù until we‚Äôre ready to evaluate.</p></li>
</ul>
</li>
</ul>
<p>Note that there isn‚Äôt good concensus on the terminology of what is validation and what is test.</p>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>Validation data is also referred to as <strong>development data</strong> or <strong>dev set</strong> for short.</p>
</div>
</div>
<div class="section" id="deployment-data">
<h3>‚ÄúDeployment‚Äù data<a class="headerlink" href="#deployment-data" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>After we build and finalize a model, we deploy it, and then the model deals with the data in the wild.</p></li>
<li><p>We will use ‚Äúdeployment‚Äù to refer to this data, where we do <strong>not</strong> have access to the target values.</p></li>
<li><p>Deployment error is what we <em>really</em> care about.</p></li>
<li><p>We use validation and test errors as proxies for deployment error, and we hope they are similar.</p></li>
<li><p>So, if our model does well on the validation and test data, we hope it will do well on deployment data.</p></li>
</ul>
</div>
<div class="section" id="summary-of-train-validation-test-and-deployment-data">
<h3>Summary of train, validation, test, and deployment data<a class="headerlink" href="#summary-of-train-validation-test-and-deployment-data" title="Permalink to this headline">¬∂</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">fit</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">score</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">predict</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Train</p></td>
<td><p>‚úîÔ∏è</p></td>
<td><p>‚úîÔ∏è</p></td>
<td><p>‚úîÔ∏è</p></td>
</tr>
<tr class="row-odd"><td><p>Validation</p></td>
<td><p></p></td>
<td><p>‚úîÔ∏è</p></td>
<td><p>‚úîÔ∏è</p></td>
</tr>
<tr class="row-even"><td><p>Test</p></td>
<td><p></p></td>
<td><p>once</p></td>
<td><p>once</p></td>
</tr>
<tr class="row-odd"><td><p>Deployment</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>‚úîÔ∏è</p></td>
</tr>
</tbody>
</table>
<p>You can typically expect <span class="math notranslate nohighlight">\(E_{train} &lt; E_{validation} &lt; E_{test} &lt; E_{deployment}\)</span>.</p>
</div>
<div class="section" id="questions-on-generalization-and-data-splitting">
<h3>‚ùì‚ùì Questions on generalization and data splitting<a class="headerlink" href="#questions-on-generalization-and-data-splitting" title="Permalink to this headline">¬∂</a></h3>
</div>
<div class="section" id="true-or-false">
<h3>True or False<a class="headerlink" href="#true-or-false" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>A decision tree model with no depth is likely to perform very well on the deployment data.</p></li>
<li><p>The primary motivation for data splitting is to help us generalize our model better.</p></li>
<li><p>Deployment data is used at the very end and only scored once.</p></li>
<li><p>Validation data could be used for hyperparameter optimization.</p></li>
</ul>
</div>
<div class="section" id="questions-for-discussion">
<h3>Questions for discussion<a class="headerlink" href="#questions-for-discussion" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Why you can typically expect <span class="math notranslate nohighlight">\(E_{train} &lt; E_{validation} &lt; E_{test} &lt; E_{deployment}\)</span>. (From Piazza.)</p></li>
<li><p>Discuss the consequences of not shuffling before splitting the data in <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="cross-validation-video">
<h2>Cross-validation [<a class="reference external" href="https://youtu.be/4cv8VYonepA">video</a>]<a class="headerlink" href="#cross-validation-video" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="problems-with-single-train-validation-split">
<h3>Problems with single train/validation split<a class="headerlink" href="#problems-with-single-train-validation-split" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Only using a portion of your data for training and only a portion for validation.</p></li>
<li><p>If your dataset is small you might end up with a tiny training and/or validation set.</p></li>
<li><p>You might be unlucky with your splits such that they don‚Äôt align well or don‚Äôt well represent your test data.</p></li>
</ul>
<p><img alt="" src="../_images/train-valid-test-split.png" /></p>
<!-- <img src='img/train-valid-test-split.png' width="1500" height="1500" /> --></div>
<div class="section" id="cross-validation-to-the-rescue">
<h3>Cross-validation to the rescue!!<a class="headerlink" href="#cross-validation-to-the-rescue" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Cross-validation provides a solution to this problem.</p></li>
<li><p>Split the data into <span class="math notranslate nohighlight">\(k\)</span> folds (<span class="math notranslate nohighlight">\(k&gt;2\)</span>, often <span class="math notranslate nohighlight">\(k=10\)</span>). In the picture below <span class="math notranslate nohighlight">\(k=4\)</span>.</p></li>
<li><p>Each ‚Äúfold‚Äù gets a turn at being the validation set.</p></li>
<li><p>Note that cross-validation doesn‚Äôt shuffle the data; it‚Äôs done in <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>.</p></li>
</ul>
<p><img alt="" src="../_images/cross-validation.png" /></p>
<!-- <img src='img/cross-validation.png' width="1500"> --><ul class="simple">
<li><p>Each fold gives a score and we usually average our <span class="math notranslate nohighlight">\(k\)</span> results.</p></li>
<li><p>It‚Äôs better to examine the variation in the scores across folds.</p></li>
<li><p>Gives a more <strong>robust</strong> measure of error on unseen data.</p></li>
</ul>
</div>
<div class="section" id="cross-validation-using-scikit-learn">
<h3>Cross-validation using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code><a class="headerlink" href="#cross-validation-using-scikit-learn" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cross-val-score">
<h4><code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code><a class="headerlink" href="#cross-val-score" title="Permalink to this headline">¬∂</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cv_scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.76470588, 0.82352941, 0.70588235, 0.94117647, 0.82352941,
       0.82352941, 0.70588235, 0.9375    , 0.9375    , 0.9375    ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average cross-validation score = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviation of cross-validation score = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average cross-validation score = 0.84
Standard deviation of cross-validation score = 0.09
</pre></div>
</div>
</div>
</div>
<p>Under the hood</p>
<ul class="simple">
<li><p>It creates <code class="docutils literal notranslate"><span class="pre">cv</span></code> folds on the data.</p></li>
<li><p>In each fold, it fits the model on the training portion and scores on the validation portion.</p></li>
<li><p>The output is a list of validation scores in each fold.</p></li>
</ul>
</div>
<div class="section" id="cross-validate">
<h4><code class="docutils literal notranslate"><span class="pre">cross_validate</span></code><a class="headerlink" href="#cross-validate" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>Similar to <code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code> but more powerful.</p></li>
<li><p>Let‚Äôs us access training and validation scores.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001413</td>
      <td>0.000818</td>
      <td>0.764706</td>
      <td>0.913333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.001142</td>
      <td>0.000788</td>
      <td>0.823529</td>
      <td>0.906667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001147</td>
      <td>0.000771</td>
      <td>0.705882</td>
      <td>0.906667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001109</td>
      <td>0.000767</td>
      <td>0.941176</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001113</td>
      <td>0.000761</td>
      <td>0.823529</td>
      <td>0.906667</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.001109</td>
      <td>0.000762</td>
      <td>0.823529</td>
      <td>0.913333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.001106</td>
      <td>0.000760</td>
      <td>0.705882</td>
      <td>0.920000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.001114</td>
      <td>0.000767</td>
      <td>0.937500</td>
      <td>0.900662</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.001105</td>
      <td>0.000763</td>
      <td>0.937500</td>
      <td>0.900662</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.001111</td>
      <td>0.000759</td>
      <td>0.937500</td>
      <td>0.900662</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.001147</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.000772</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.840074</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.906865</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Keep in mind that cross-validation does not return a model. It is not a way to build a model that can be applied to new data. The purpose of cross-validation is to <strong>evaluate</strong> how well the model will generalize to unseen data.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Note that both <code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code> and <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> functions do not shuffle the data. Check out <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html#sklearn.model_selection.StratifiedKFold"><code class="docutils literal notranslate"><span class="pre">StratifiedKFold</span></code></a>, where proportions of classes is the same in each fold as they are in the whole dataset. By default, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> uses <code class="docutils literal notranslate"><span class="pre">StratifiedKFold</span></code> when carrying out cross-validation for classification problems.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_cross_validation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_83_0.png" src="../_images/03_ml-fundamentals_83_0.png" />
</div>
</div>
</div>
<div class="section" id="our-typical-supervised-learning-set-up-is-as-follows">
<h4>Our typical supervised learning set up is as follows:<a class="headerlink" href="#our-typical-supervised-learning-set-up-is-as-follows" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>We are given training data with features <code class="docutils literal notranslate"><span class="pre">X</span></code> and target <code class="docutils literal notranslate"><span class="pre">y</span></code></p></li>
<li><p>We split the data into train and test portions: <code class="docutils literal notranslate"><span class="pre">X_train,</span> <span class="pre">y_train,</span> <span class="pre">X_test,</span> <span class="pre">y_test</span></code></p></li>
<li><p>We carry out hyperparameter optimization using cross-validation on the train portion: <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and <code class="docutils literal notranslate"><span class="pre">y_train</span></code>.</p></li>
<li><p>We assess our best performing model on the test portion: <code class="docutils literal notranslate"><span class="pre">X_test</span></code> and <code class="docutils literal notranslate"><span class="pre">y_test</span></code>.</p></li>
<li><p>What we care about is the <strong>test error</strong>, which tells us how well our model can be generalized.</p></li>
<li><p>If this test error is ‚Äúreasonable‚Äù we deploy the model which will be used on new unseen examples.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001486</td>
      <td>0.000845</td>
      <td>0.875000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.001180</td>
      <td>0.000799</td>
      <td>0.875000</td>
      <td>0.992857</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001172</td>
      <td>0.000807</td>
      <td>0.875000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001183</td>
      <td>0.000799</td>
      <td>0.687500</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001260</td>
      <td>0.000776</td>
      <td>0.812500</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.001133</td>
      <td>0.000774</td>
      <td>0.812500</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.001150</td>
      <td>0.000968</td>
      <td>0.866667</td>
      <td>0.985816</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.001180</td>
      <td>0.000776</td>
      <td>0.533333</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.001140</td>
      <td>0.000772</td>
      <td>0.666667</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.001125</td>
      <td>0.000771</td>
      <td>0.733333</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns mean and std of cross validation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">mean_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">out_col</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_scores</span><span class="p">)):</span>
        <span class="n">out_col</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;%0.3f (+/- %0.3f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean_scores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">out_col</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mean_scores</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Decision tree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Decision tree</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.762 (+/- 0.051)</td>
      <td>0.994 (+/- 0.014)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>How do we know whether this test score is reasonable?</p></li>
</ul>
</div>
</div>
<div class="section" id="questions-on-cross-validation">
<h3>‚ùì‚ùì Questions on cross-validation<a class="headerlink" href="#questions-on-cross-validation" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(k\)</span>-fold cross-validation calls fit <span class="math notranslate nohighlight">\(k\)</span> times and predict <span class="math notranslate nohighlight">\(k\)</span> times. True or False?</p></li>
<li><p>We use cross-validation to improve model performance. True or False?</p></li>
<li><p>If we are using a single validation set, you may get unrealistically high or low validation accuracies.</p></li>
<li><p>Discuss advantages and disadvantages of cross-validation?</p></li>
</ul>
<div class="admonition-exercise-3-1-cross-validation admonition">
<p class="admonition-title">Exercise 3.1: Cross-validation</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(k\)</span>-fold cross-validation calls fit <span class="math notranslate nohighlight">\(k\)</span> times and predict <span class="math notranslate nohighlight">\(k\)</span> times. True or False?</p></li>
<li><p>We use cross-validation to improve model performance. True or False?</p></li>
<li><p>Discuss advantages and disadvantages of cross-validation?</p></li>
</ol>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Exercise 3.1: Solutions!</p>
<p>TBD</p>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="underfitting-overfitting-the-fundamental-trade-off-the-golden-rule-video">
<h2>Underfitting, overfitting, the fundamental trade-off, the golden rule [<a class="reference external" href="https://youtu.be/Ihay8yE5KTI">video</a>]<a class="headerlink" href="#underfitting-overfitting-the-fundamental-trade-off-the-golden-rule-video" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="types-of-errors">
<h3>Types of errors<a class="headerlink" href="#types-of-errors" title="Permalink to this headline">¬∂</a></h3>
<p>Imagine that your train and validation errors do not align with each other. How do you diagnose the problem?</p>
<p>We‚Äôre going to think about 4 types of errors:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E_\textrm{train}\)</span> is your training error (or mean train error from cross-validation).</p></li>
<li><p><span class="math notranslate nohighlight">\(E_\textrm{valid}\)</span> is your validation error (or mean validation error from cross-validation).</p></li>
<li><p><span class="math notranslate nohighlight">\(E_\textrm{test}\)</span> is your test error.</p></li>
<li><p><span class="math notranslate nohighlight">\(E_\textrm{best}\)</span> is the best possible error you could get for a given problem.</p></li>
</ul>
</div>
<div class="section" id="underfitting">
<h3>Underfitting<a class="headerlink" href="#underfitting" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># decision stump</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train error:   0.188
Validation error:   0.212
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>If your model is too simple, like <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> or <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> with <code class="docutils literal notranslate"><span class="pre">max_depth=1</span></code>, it‚Äôs not going to pick up on some random quirks in the data but it won‚Äôt even capture useful patterns in the training data.</p></li>
<li><p>The model won‚Äôt be very good in general. Both train and validation errors would be high. This is <strong>underfitting</strong>.</p></li>
<li><p>The gap between train and validation error is going to be lower.</p></li>
<li><p><span class="math notranslate nohighlight">\(E_\textrm{best} \lt E_\textrm{train} \lesssim E_\textrm{valid}\)</span></p></li>
</ul>
</div>
<div class="section" id="overfitting">
<h3>Overfitting<a class="headerlink" href="#overfitting" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation error:   </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train error:   0.000
Validation error:   0.220
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>If your model is very complex, like a <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier(max_depth=None)</span></code>, then you will learn unreliable patterns in order to get every single training example correct.</p></li>
<li><p>The training error is going to be very low but there will be a big gap between the training error and the validation error. This is <strong>overfitting</strong>.</p></li>
<li><p>In overfitting scenario, usually we‚Äôll see:
<span class="math notranslate nohighlight">\(E_\textrm{train} \lt E_\textrm{best}  \lt E_\textrm{valid}\)</span></p></li>
<li><p>In general, if <span class="math notranslate nohighlight">\(E_\textrm{train}\)</span> is low, we are likely to be in the overfitting scenario. It is fairly common to have at least a bit of this.</p></li>
</ul>
<ul class="simple">
<li><p>So the validation error does not necessarily decrease with the training error.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;mean_train_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;mean_cv_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;std_cv_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;std_train_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;max_depth&quot;</span><span class="p">]:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_cv_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]))</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_train_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">]))</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;std_cv_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;std_train_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;depth&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span><span class="p">[[</span><span class="s2">&quot;mean_train_error&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_cv_error&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_ml-fundamentals_104_0.png" src="../_images/03_ml-fundamentals_104_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Here, for larger depths we observe that the training error is close to 0 but validation error goes up and down.</p></li>
<li><p>As we make more complex models we start encoding random quirks in the data, which are not grounded in reality.</p></li>
<li><p>These random quirks do not generalize well to new data.</p></li>
<li><p>This problem of failing to be able to generalize to the validation data or test data is called <strong>overfitting</strong>.</p></li>
</ul>
</div>
<div class="section" id="the-fundamental-tradeoff-of-supervised-learning">
<h3>The ‚Äúfundamental tradeoff‚Äù of supervised learning:<a class="headerlink" href="#the-fundamental-tradeoff-of-supervised-learning" title="Permalink to this headline">¬∂</a></h3>
<p><strong>As you increase model complexity, <span class="math notranslate nohighlight">\(E_\textrm{train}\)</span> tends to go down but <span class="math notranslate nohighlight">\(E_\textrm{valid}-E_\textrm{train}\)</span> tends to go up.</strong></p>
</div>
<div class="section" id="bias-vs-variance-tradeoff">
<h3>Bias vs variance tradeoff<a class="headerlink" href="#bias-vs-variance-tradeoff" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>The fundamental trade-off is also called the bias/variance tradeoff in supervised machine learning.</p></li>
</ul>
<dl class="simple myst">
<dt><strong>Bias</strong></dt><dd><p>the tendency to consistently learn the same wrong thing (high bias corresponds to underfitting)</p>
</dd>
<dt><strong>Variance</strong></dt><dd><p>the tendency to learn random things irrespective of the real signal (high variance corresponds to overfitting)</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Check out <a class="reference external" href="https://homes.cs.washington.edu/~pedrod/papers/cacm12.pdf">this article by Pedro Domingos</a> for some approachable explanation on machine learning fundamentals and bias-variance tradeoff.</p>
</div>
</div>
<div class="section" id="how-to-pick-a-model-that-would-generalize-better">
<h3>How to pick a model that would generalize better?<a class="headerlink" href="#how-to-pick-a-model-that-would-generalize-better" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>We want to avoid both underfitting and overfitting.</p></li>
<li><p>We want to be consistent with the training data but we don‚Äôt to rely too much on it.</p></li>
</ul>
<!-- <center>
<img src='img/malp_0201.png' width="800" height="800" />
</center>    
 -->
<p><img alt="" src="../_images/malp_0201.png" /></p>
<p><a class="reference external" href="https://learning.oreilly.com/library/view/introduction-to-machine/9781449369880/ch02.html#relation-of-model-complexity-to-dataset-size">source</a></p>
<ul class="simple">
<li><p>There are many subtleties here and there is no perfect answer but a  common practice is to pick the model with minimum cross-validation error.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cross_validate_std</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Like cross_validate, except also gives the standard deviation of the score&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">res_mean</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">res_mean</span><span class="p">[</span><span class="s2">&quot;std_test_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;train_score&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">res_mean</span><span class="p">[</span><span class="s2">&quot;std_train_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">res_mean</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_train_error</th>
      <th>mean_cv_error</th>
      <th>std_cv_error</th>
      <th>std_train_error</th>
    </tr>
    <tr>
      <th>depth</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.171657</td>
      <td>0.211250</td>
      <td>0.048378</td>
      <td>0.006805</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.160258</td>
      <td>0.217500</td>
      <td>0.048940</td>
      <td>0.007316</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.142467</td>
      <td>0.204583</td>
      <td>0.053763</td>
      <td>0.022848</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.092604</td>
      <td>0.197917</td>
      <td>0.056955</td>
      <td>0.006531</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.083338</td>
      <td>0.191250</td>
      <td>0.067120</td>
      <td>0.010650</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.066960</td>
      <td>0.191250</td>
      <td>0.072707</td>
      <td>0.012065</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.044873</td>
      <td>0.223333</td>
      <td>0.080734</td>
      <td>0.009059</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.029909</td>
      <td>0.216250</td>
      <td>0.096833</td>
      <td>0.009422</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.020653</td>
      <td>0.210000</td>
      <td>0.087999</td>
      <td>0.010294</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.010679</td>
      <td>0.229167</td>
      <td>0.097859</td>
      <td>0.007938</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.005699</td>
      <td>0.215833</td>
      <td>0.105702</td>
      <td>0.004264</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.003561</td>
      <td>0.242083</td>
      <td>0.086932</td>
      <td>0.004769</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.000000</td>
      <td>0.235833</td>
      <td>0.088373</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.000000</td>
      <td>0.248333</td>
      <td>0.089485</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000000</td>
      <td>0.235833</td>
      <td>0.092687</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="test-score-vs-cross-validation-score">
<h3>test score vs. cross-validation score<a class="headerlink" href="#test-score-vs-cross-validation-score" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_depth</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;mean_cv_error&quot;</span><span class="p">])]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The minimum validation error is </span><span class="si">%0.3f</span><span class="s2"> at max_depth = </span><span class="si">%d</span><span class="s2"> &quot;</span>
    <span class="o">%</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;mean_cv_error&quot;</span><span class="p">]),</span>
        <span class="n">best_depth</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The minimum validation error is 0.191 at max_depth = 5 
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let‚Äôs pick <code class="docutils literal notranslate"><span class="pre">max_depth</span></code>= 5 and try this model on the test set.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">best_depth</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error on test set: </span><span class="si">{</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error on test set: 0.19
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The test error is comparable with the cross-validation error.</p></li>
<li><p>Do we feel confident that this model would give similar performace when deployed?</p></li>
</ul>
</div>
<div class="section" id="the-golden-rule-a-name-4-a">
<h3>The golden rule <a name="4"></a><a class="headerlink" href="#the-golden-rule-a-name-4-a" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Even though we care the most about test error <strong>THE TEST DATA CANNOT INFLUENCE THE TRAINING PHASE IN ANY WAY</strong>.</p></li>
<li><p>We have to be very careful not to violate it while developing our ML pipeline.</p></li>
<li><p>Even experts end up breaking it sometimes which leads to misleading results and lack of generalization on the real data.</p></li>
</ul>
<div class="section" id="golden-rule-violation-example-1">
<h4>Golden rule violation: Example 1<a class="headerlink" href="#golden-rule-violation-example-1" title="Permalink to this headline">¬∂</a></h4>
<p><img alt="" src="../_images/golden_rule_violation.png" /></p>
<!-- <center>
<img src='img/golden_rule_violation.png' width="500" height="500" />
</center>    
 -->
<blockquote>
   ... He attempted to reproduce the research, and found a major flaw: there was some overlap in the data used to both train and test the model. 
</blockquote>    </div>
<div class="section" id="golden-rule-violation-example-2">
<h4>Golden rule violation: Example 2<a class="headerlink" href="#golden-rule-violation-example-2" title="Permalink to this headline">¬∂</a></h4>
<!-- <center>
<img src='img/golden_rule_violation_2.png' width="500" height="500" />
</center>    
 -->
<p><img alt="" src="../_images/golden_rule_violation_2.png" /></p>
<blockquote>
  ... The Challenge rules state that you must only test your code twice a week, because there‚Äôs an element of chance to the results. Baidu has admitted that it used multiple email accounts to test its code roughly 200 times in just under six months ‚Äì over four times what the rules allow.
</blockquote>
</div>
</div>
<div class="section" id="how-can-we-avoid-violating-golden-rule">
<h3>How can we avoid violating golden rule?<a class="headerlink" href="#how-can-we-avoid-violating-golden-rule" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Recall that when we split data, we put our test set in an imaginary vault.</p></li>
</ul>
<!-- <center>
<img src='img/train-test-split.png' width="1500" height="1500" />
</center>    
 -->
<p><img alt="" src="../_images/train-test-split.png" /></p>
</div>
<div class="section" id="here-is-the-workflow-we-ll-generally-follow">
<h3>Here is the workflow we‚Äôll generally follow.<a class="headerlink" href="#here-is-the-workflow-we-ll-generally-follow" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><strong>Splitting</strong>: Before doing anything, split the data <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> into <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_test</span></code>, <code class="docutils literal notranslate"><span class="pre">y_train</span></code>, <code class="docutils literal notranslate"><span class="pre">y_test</span></code> or <code class="docutils literal notranslate"><span class="pre">train_df</span></code> and <code class="docutils literal notranslate"><span class="pre">test_df</span></code> using <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>.</p></li>
<li><p><strong>Select the best model using cross-validation</strong>: Use <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> with <code class="docutils literal notranslate"><span class="pre">return_train_score</span> <span class="pre">=</span> <span class="pre">True</span></code> so that we can get access to training scores in each fold. (If we want to plot train vs validation error plots, for instance.)</p></li>
<li><p><strong>Scoring on test data</strong>: Finally score on the test data with the chosen hyperparameters to examine the generalization performance.</p></li>
</ul>
<p><strong>Again, there are many subtleties here we‚Äôll discuss the golden rule multiple times throughout the course and in the program.</strong></p>
<p><br><br><br><br></p>
</div>
<div class="section" id="questions-for-you">
<h3>‚ùì‚ùì Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this headline">¬∂</a></h3>
</div>
<div class="section" id="underfitting-or-overfitting">
<h3>Underfitting or overfitting?<a class="headerlink" href="#underfitting-or-overfitting" title="Permalink to this headline">¬∂</a></h3>
<ol class="simple">
<li><p>If the mean train accuracy is much higher than the mean cross-validation accuracy.</p></li>
<li><p>If the mean train accuracy and the mean cross-validation accuracy are both low and relatively similar in value.</p></li>
<li><p>Decision tree with no limit on the depth.</p></li>
<li><p>Decision stump on a complicated classification problem.</p></li>
</ol>
<div class="admonition-exercise-3-3 admonition">
<p class="admonition-title">Exercise 3.3</p>
<p>Underfitting or overfitting?</p>
<ol class="simple">
<li><p>If the mean train accuracy is much higher than the mean cross-validation accuracy.</p></li>
<li><p>If the mean train accuracy and the mean cross-validation accuracy are both low and relatively similar in value.</p></li>
<li><p>Decision tree with no limit on the depth.</p></li>
<li><p>Decision stump on a complicated classification problem.</p></li>
</ol>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Exercise 3.3: Solutions!</p>
<p>TBD</p>
</div>
</div>
<div class="section" id="state-whether-true-false">
<h3>State whether True/False.<a class="headerlink" href="#state-whether-true-false" title="Permalink to this headline">¬∂</a></h3>
<ol class="simple">
<li><p>In supervised learning, the training error is always lower than the validation error.</p></li>
<li><p>The fundamental tradeoff of ML states that as training error goes down, validation error goes up.</p></li>
<li><p>More ‚Äúcomplicated‚Äù models are more likely to overfit than ‚Äúsimple‚Äù ones.</p></li>
<li><p>If we had an infinite amount of training data, overfitting would not be a problem.</p></li>
<li><p>If our training error is extremely low, that means we‚Äôre overfitting.</p></li>
</ol>
<div class="admonition-exercise-3-4 admonition">
<p class="admonition-title">Exercise 3.4</p>
<p>State whether True/False.</p>
<ol class="simple">
<li><p>In supervised learning, the training error is always lower than the validation error.</p></li>
<li><p>The fundamental tradeoff of ML states that as training error goes down, validation error goes up.</p></li>
<li><p>More ‚Äúcomplicated‚Äù models are more likely to overfit than ‚Äúsimple‚Äù ones.</p></li>
<li><p>If we had an infinite amount of training data, overfitting would not be a problem.</p></li>
<li><p>If our training error is extremely low, that means we‚Äôre overfitting.</p></li>
</ol>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Exercise 3.4: Solutions!</p>
<p>TBD</p>
</div>
</div>
</div>
<div class="section" id="what-did-we-learn-today">
<h2>What did we learn today?<a class="headerlink" href="#what-did-we-learn-today" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>Importance of generalization in supervised machine learning.</p></li>
<li><p>Data splitting as a way to approximate generalization error.</p></li>
<li><p>Train, test, validation, deployment data</p></li>
<li><p>Cross-validation</p></li>
<li><p>A typical sequence of steps to train supervised machine learning models.</p>
<ul>
<li><p>training the model on the train split</p></li>
<li><p>tuning hyperparamters using the validation split</p></li>
<li><p>checking the generalization performance on the test split.</p></li>
</ul>
</li>
<li><p>Overfitting, underfitting, the fundamental tradeoff, and the golden rule.</p></li>
</ul>
<div class="section" id="coming-up">
<h3>Coming up ‚Ä¶<a class="headerlink" href="#coming-up" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>KNNs, SVM RBFs</p></li>
<li><p>Preprocessing</p>
<ul>
<li><p>Imputation</p></li>
<li><p>Scaling</p></li>
<li><p>One-hot encoding</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/eva-seeyou.png" /></p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>